$.ajax({
    type: "GET",
    url: url,
    dataType: 'json',
    data: {
        action: "loadBySpatial",
        lat: position.coords.latitude,
        lon: position.coords.longitude,
        radius: 100000,
        maxResults: 750
    }
}).success(function(response) {
    var markers = new Array();
    var keys = Object.keys(response);

    for (var i = 0; i < keys.length; i ++){
        var sensorKey = keys[i];
        var sensorName = response[keys[i]].attributes.name;
        var sensorType = response[keys[i]].attributes.type;
        var sensorIcon;

        switch (sensorType) {
            case ('bus'):
                sensorIcon = 'bus.png';
                break;
            case ('wlanstation'):
                sensorIcon = 'wlan.png';
                break;
            case ('weatherstation'):
                sensorIcon = 'weather.png';
                break;
            case ('parkinghall'):
                sensorIcon = 'parking.png';
                break;
            case ('trafficcamera'):
                sensorIcon = 'cam.png';
                break;
            case ('trafficstation'):
                sensorIcon = 'traffic.png';
                break;
        }

        var sensorLat = response[keys[i]].attributes.gps[0];
        var sensorLng = response[keys[i]].attributes.gps[1];

        var sensorPosition = new google.maps.LatLng(sensorLat, sensorLng);

        markers[i] = new google.maps.Marker({
            position: sensorPosition,
            title: sensorName,
            map: map,
            icon: sensorIcon
        });

        if (sensorType == "bus"){
            busMarkers.push(markers[i]);
            addOnBusClick(markers[i], sensorKey);
        }else if (sensorType == "trafficcamera"){
            camMarkers.push(markers[i]);
            addOnCamClick(markers[i], sensorKey);
        }else if (sensorType != "wlanstation"){
            addOnInfoClick(markers[i], sensorKey);
            if (sensorType == "weatherstation"){
                weatherMarkers.push(markers[i]);
            }
            if (sensorType == "trafficstation"){
                trafficMarkers.push(markers[i]);
            }
            if (sensorType == "parkinghall"){
                parkingMarkers.push(markers[i]);
            }
        }else{
            wlanMarkers.push(markers[i]);
        }
    }
});



var busRoute = new google.maps.Polyline({
                    path: busRoutes[sensorKey],
                    map: map,
                    geodesic: true,
                    strokeColor: '#FF0000',
                    strokeOpacity: 1.0,
                    strokeWeight: 2
                });